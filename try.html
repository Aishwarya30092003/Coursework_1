<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <script src="product.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
        integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <title>After School Hub</title>
</head>

<body>
    <div id="app">
        <header>
            <div class="navbar">
                <div class="logo">
                    <h1> After School Hub </h1>
                </div>
                <div class="search-bar">
                    <input type="text" placeholder="Search...">
                    <button>Search</button>
                </div>
                <button class="fas fa-shopping-cart" v-on:click="showCheckout" :disabled="cartItemCount === 0">
                    {{cartItemCount}}
                </button>
            </div>
        </header>
        <main>
            <div class="mainDiv" style="display: flex; height: 100vh; width: 100%; background-color:black;">
                <div class="sortDiv">
                    <div class="filteringDiv">
                        <p>Filter By:</p>
                        <br>
                        <label>
                            <input type="radio" value="fees" v-model="filter">Fees
                            <br>
                            <input type="radio" value="subj" v-model="filter">Subject
                            <br>
                            <input type="radio" value="loc" v-model="filter">Location
                            <br>
                            <input type="radio" value="slots" v-model="filter">Slots
                        </label>
                    </div>
                </div>
                <div class="productMainDiv">
                    <div class="products" v-if="showProduct">
                        <div class="productDetails" v-for="product in sortedProducts">
                            <figure>
                                <!--bind 'src' attr to 'product.image' in 'data'-->
                                <img v-bind:src="product.image" style="height: 100px; width: 100px">
                            </figure>
                            <h2 v-text="product.title"></h2>
                            <p>Price: {{product.price}} AED</p>
                            <p>Location: {{product.location}}</p>
                            <p>Available Slots: {{product.availableInventory - cartCount(product.id)}} </p>
                            <button class="addToCart" v-on:click="addToCart(product)" v-if="canAddToCart(product)">
                                Add To Cart
                            </button>
                            <!--This button will be displayed otherwise-->
                            <button class="addToCart" disabled="disabled" v-else>
                                Add To Cart
                            </button>
                            <span v-if="product.availableInventory === cartCount(product.id)">All out!</span>
                            <span v-else-if="product.availableInventory - cartCount(product.id) < 5">Only
                                {{product.availableInventory - cartCount(product.id)}} left!</span>
                        </div>
                    </div>
                    <div v-else>
                        <!-- PLACE ORDER BUTTON -->
                        <div class="cart-items">
                            <div v-for="product in cartProducts" class="cartProducts">
                                <figure>
                                    <img v-bind:src="product.image" height="100px" width="100px">
                                </figure>
                                <h2 v-text="product.title"></h2>
                                <p v-text="product.description"></p>
                                <br>
                                <p>Price: {{product.price}} </p>
                                <br>
                                <p>Quantity: {{cartCount(product.id)}}</p>
                                <button class="removeButton" v-on:click="deleteFromCart(product.id)">Remove</button>
                            </div>
                            <div style="color: white;">
                                <h2>Order Information</h2>
                                <p>First Name: {{order.firstName}} </p>
                                <p>Last Name: {{order.lastName}} </p>
                                <p>Phone: {{order.phone}} </p>
                                <button v-on:click="submitForm">Place Order</button>
                            </div>
                        </div>
                    </div>


                </div>


            </div>
        </main>

    </div>
</body>
<script type="text/javascript">
    let webstore = new Vue({ //The Vue instance
        el: '#app', //The 'option object': DOM mounting point
        data: {
            showProduct: true,
            sitename: 'After school hub',
            products: products,
            filter: '',
            order: {
                firstName: '',
                lastName: '',
                phone: ''
            },
            cart: [], //array to store items in shopping cart
        },
        methods: {
            addToCart(product) {
                this.cart.push(product.id);
                console.log('Cart:', this.cart);
            },
            showCheckout: function () {
                this.showProduct = !this.showProduct;
            },
            submitForm() { alert('Order Submitted!') },
            canAddToCart(product) { // moved it here because computed property because we want to pass our produc in and we cant do it in computed property.
                return product.availableInventory > this.cartCount(product.id);
            },
            cartCount(id) {
                let count = 0;
                for (let i = 0; i < this.cart.length; i++) {
                    if (this.cart[i] === id) {
                        count++;
                    }
                }
                return count;
            },
            deleteFromCart(id) {
                let found = false
                function cartRefresh(cartItem) {
                    if (found == false) {
                        if (cartItem == id) {
                            found = true;
                        } else {
                            return cartItem;
                        }
                    } else {
                        return cartItem;
                    }
                }
                this.cart = this.cart.filter(cartRefresh);
            },

        },
        computed: { //the computed property object
            cartItemCount: function () {  //the property name
                //its value when calculated
                return this.cart.length || '';
            },
            sortedProducts() {
                let productsArray = this.products.slice(0);
                function compare(a, b) {
                    if (a.price > b.price)
                        return 1;
                    if (a.price < b.price)
                        return -1;
                    return 0;
                }
                return productsArray.sort(compare);
            },
            cartProducts() {
                let productsArray = this.products.slice(0);
                let cartProducts = [];
                for (let i = 0; i < productsArray.length; i++) {
                    for (let j = 0; j < this.cart.length; j++) {
                        if (productsArray[i].id == this.cart[j]) {
                            cartProducts.push(productsArray[i])
                            break;
                        } else {
                            continue;
                        }
                    }
                }
                return cartProducts;
            }

        }
    });
</script>

</html>