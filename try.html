<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <script src="product.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
        integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <title>After School Hub</title>
</head>

<body>
    <header>
        <div class="navbar">
            <div class="logo">
                <h1> After School Hub </h1>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Search...">
                <button>Search</button>
            </div>
            <div class="cart-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
        </div>
    </header>
    <div id="app">
        <main>
            <div class="mainDiv" style="display: flex; height: 100vh; width: 100%; background-color:black;">
                <div class="sortDiv">
                    <div class="filteringDiv">
                        <p>Sort</p>
                    </div>
                </div>
                <div class="productMainDiv" >
                    <div class="products" v-if="showProduct" >
                        <div class="productDetails" v-for="product in sortedProducts">
                            <figure>
                                <!--bind 'src' attr to 'product.image' in 'data'-->
                                <img v-bind:src="product.image" style="height: 100px; width: 100px">
                            </figure>
                            <h2 v-text="product.title"></h2>
                            <p>Price: {{product.price}} AED</p>
                            <p>Location: {{product.location}}</p>
                            <p>Available Slots: {{product.availableInventory - cartCount(product.id)}} </p>
                            <button class="addToCart" v-on:click="addToCart(product)" v-if="canAddToCart(product)">
                                Add To Cart
                            </button>
                            <!--This button will be displayed otherwise-->
                            <button class="addToCart" disabled="disabled" v-else>
                                Add To Cart
                            </button>
                            <span v-if="product.availableInventory === cartCount(product.id)">All out!</span>
                            <span v-else-if="product.availableInventory - cartCount(product.id) < 5">Only
                                {{product.availableInventory - cartCount(product.id)}} left!</span>
                        </div>
                    </div>
                </div>

            </div>
</body>
<script type="text/javascript">
    let webstore = new Vue({ //The Vue instance
        el: '#app', //The 'option object': DOM mounting point
        data: {
            showProduct: true,
            sitename: 'After school hub',
            products: products,
            order: {
                firstName: '',
                lastName: '',
                address: '',
                city: '',
                zip: '',
                state: '',
                method: 'Home',
                // gift: false,
                sendGift: 'Send as Gift',
                dontSendGift: 'Do Not Send As Gift'
            },
            states: {
                AL: 'Alabama',
                AR: 'Arizona',
                CA: 'California',
                NV: 'Nevada'
            },

            cart: [], //array to store items in shopping cart
        },
        methods: {
            addToCart(product) {
                this.cart.push(product.id);
                // console.log(this.cart);
            },
            showCheckout() {
                this.showProduct = this.showProduct ? false : true;
            },
            submitForm() { alert('Order Submitted!') },
            canAddToCart(product) { // moved it here because computed property because we want to pass our produc in and we cant do it in computed property.
                return product.availableInventory > this.cartCount(product.id);
            },
            cartCount(id) {
                let count = 0;
                for (let i = 0; i < this.cart.length; i++) {
                    if (this.cart[i] === id) {
                        count++;
                    }
                }
                return count;
            }
        },
        computed: { //the computed property object
            cartItemCount: function () {  //the property name
                //its value when calculated
                return this.cart.length || '';
            },
            sortedProducts() {
                let productsArray = this.products.slice(0);
                function compare(a, b) {
                    if (a.price > b.price)
                        return 1;
                    if (a.price < b.price)
                        return -1;
                    return 0;
                }
                return productsArray.sort(compare);
            }

        }
    });
</script>

</html>